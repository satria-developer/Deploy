<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy HTML ke Vercel via GitHub</title>
    <style>
        /* [Styles tetap sama seperti sebelumnya] */
    </style>
</head>
<body>
    <!-- [HTML struktur tetap sama seperti sebelumnya] -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            const fileList = document.getElementById('fileList');
            const domainInput = document.getElementById('domainInput');
            const deployBtn = document.getElementById('deployBtn');
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            const deployUrl = document.getElementById('deployUrl');
            const githubUrl = document.getElementById('githubUrl');
            const progressSteps = document.getElementById('progressSteps');
            
            // API Configuration - Token disembunyikan dalam kode
            const API_CREDENTIALS = {
                GITHUB: {
                    TOKEN: atob('Z2hwXzJGNXhKU0diQXNLUktXd0sxQ3U3RElWNlFwWVl1OTAhelF3Yg=='), // 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
                    USERNAME: 'satria-developer',
                    REPO: 'html-deployer'
                },
                VERCEL: {
                    TOKEN: atob('UUFLREVETHNVTmNRTnU0M3loVlBiam4y') // QAKDEDLsUNcQNu43yhVPbjn2
                }
            };
            
            const GITHUB_API_URL = 'https://api.github.com';
            const VERCEL_API_URL = 'https://api.vercel.com/v13/deployments';
            
            // State
            let selectedFile = null;
            
            // [Event listeners dan fungsi pendukung tetap sama]
            
            async function deployProject() {
                if (!selectedFile) {
                    showStatus('Error: Silakan pilih file HTML terlebih dahulu', 'error');
                    return;
                }
                
                const domain = domainInput.value.trim();
                if (!domain) {
                    showStatus('Error: Silakan masukkan nama domain', 'error');
                    return;
                }
                
                deployBtn.disabled = true;
                showStatus('Memulai proses deployment...', '');
                progressSteps.innerHTML = '';
                
                try {
                    // Step 1: Upload to GitHub
                    addProgressStep('Mengupload file ke GitHub...');
                    const githubFileUrl = await uploadToGitHub(selectedFile);
                    completeProgressStep('File berhasil diupload ke GitHub');
                    
                    // Step 2: Deploy to Vercel
                    addProgressStep('Mendeploy ke Vercel...');
                    const vercelUrl = await deployToVercel(githubFileUrl, domain);
                    completeProgressStep('Deploy ke Vercel berhasil');
                    
                    // Show success result
                    const finalUrl = `https://${domain}.vercel.app`;
                    deployUrl.href = finalUrl;
                    deployUrl.textContent = finalUrl;
                    githubUrl.innerHTML = `File GitHub: <a href="${githubFileUrl}" target="_blank">${githubFileUrl}</a>`;
                    resultDiv.style.display = 'block';
                    showStatus('Deploy berhasil!', 'success');
                } catch (error) {
                    console.error('Deployment error:', error);
                    showStatus(`Error: ${error.message}`, 'error');
                    failProgressStep(error.message);
                } finally {
                    deployBtn.disabled = false;
                }
            }
            
            async function uploadToGitHub(file) {
                try {
                    const content = await readFileAsBase64(file);
                    const path = file.name;
                    const message = `Add ${file.name}`;
                    
                    // Check if repo exists first
                    let repoExists = true;
                    try {
                        await fetch(`${GITHUB_API_URL}/repos/${API_CREDENTIALS.GITHUB.USERNAME}/${API_CREDENTIALS.GITHUB.REPO}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `token ${API_CREDENTIALS.GITHUB.TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                    } catch (e) {
                        repoExists = false;
                    }
                    
                    // Create repo if not exists
                    if (!repoExists) {
                        addProgressStep('Membuat repository GitHub baru...');
                        const createResponse = await fetch(`${GITHUB_API_URL}/user/repos`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `token ${API_CREDENTIALS.GITHUB.TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: API_CREDENTIALS.GITHUB.REPO,
                                private: false,
                                auto_init: false
                            })
                        });
                        
                        if (!createResponse.ok) {
                            const errorData = await createResponse.json();
                            throw new Error(errorData.message || 'Gagal membuat repository GitHub');
                        }
                        completeProgressStep('Repository GitHub berhasil dibuat');
                    }
                    
                    // Upload file
                    const response = await fetch(`${GITHUB_API_URL}/repos/${API_CREDENTIALS.GITHUB.USERNAME}/${API_CREDENTIALS.GITHUB.REPO}/contents/${path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${API_CREDENTIALS.GITHUB.TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: message,
                            content: content,
                            branch: 'main'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Gagal mengupload ke GitHub');
                    }
                    
                    return data.content.html_url;
                } catch (error) {
                    throw new Error(`GitHub upload failed: ${error.message}`);
                }
            }
            
            async function deployToVercel(githubFileUrl, domain) {
                try {
                    const deploymentConfig = {
                        name: domain,
                        gitSource: {
                            type: 'github',
                            repo: `${API_CREDENTIALS.GITHUB.USERNAME}/${API_CREDENTIALS.GITHUB.REPO}`,
                            ref: 'main'
                        }
                    };
                    
                    const response = await fetch(VERCEL_API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${API_CREDENTIALS.VERCEL.TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(deploymentConfig)
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error?.message || 'Gagal mendeploy ke Vercel');
                    }
                    
                    return `https://${domain}.vercel.app`;
                } catch (error) {
                    throw new Error(`Vercel deployment failed: ${error.message}`);
                }
            }
            
            // [Fungsi-fungsi pendukung lainnya tetap sama]
        });
    </script>
</body>
</html>